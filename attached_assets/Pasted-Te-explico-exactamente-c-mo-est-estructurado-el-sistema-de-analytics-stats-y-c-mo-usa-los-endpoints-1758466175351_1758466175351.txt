Te explico exactamente cÃ³mo estÃ¡ estructurado el sistema de analytics/stats y cÃ³mo usa los endpoints:

ğŸ“¡ Endpoints que Estoy Usando
El sistema usa 3 endpoints especializados de tu backend Django:

1. /api/v1/stats/search-tracking/    â†’ SearchDashboard  
2. /api/v1/stats/ingresos/           â†’ IngresosDashboard
3. /api/v1/upcoming-checkins/        â†’ CheckinsDashboard
ğŸ—ï¸ Arquitectura del Sistema
1. PÃ¡gina Principal (StatsPage.tsx)
Navigation: Tabs en el header (no sidebar)
Filtros Globales: Un sistema unificado que se comparte entre todos los dashboards
TabPanel: Renderiza cada dashboard segÃºn el tab activo
2. Servicios RTK Query (/services/analytics/)
Cada endpoint tiene su propio servicio:

// searchTrackingService.ts
baseUrl: `${ENV.API_URL}/stats`
endpoint: `search-tracking?${params}`
// ingresosService.ts  
baseUrl: `${ENV.API_URL}/stats`
endpoint: `ingresos?${params}`
// newUpcomingCheckinsService.ts
baseUrl: `${ENV.API_URL}`
endpoint: `upcoming-checkins?${params}`
3. ParÃ¡metros que EnvÃ­o a Cada Endpoint
Search Tracking:

{
  date_from: "2024-08-22",
  date_to: "2024-09-21", 
  include_clients: true,
  include_anonymous: true
}
Ingresos:

{
  date_from: "2024-08-22",
  date_to: "2024-09-21",
  period: "week",        // day/week/month
  currency: "PEN"        // PEN/USD
}
Upcoming Checkins:

{
  days_ahead: 60,
  limit: 20,
  include_anonymous: true
}
ğŸ“Š Estructura de Datos (Interfaces)
Cada endpoint devuelve una estructura especÃ­fica:

Search Tracking Response:
{
  success: boolean,
  data: {
    search_summary: { total_searches, unique_clients_searching, conversion_rate... }
    searches_by_weekday: [{ weekday, searches_count, percentage }]
    top_searched_properties: [{ property_name, search_count, percentage }]
    top_searching_clients: [{ client_name, search_count, last_search_date }]
    anonymous_ips_analysis: [{ ip_last_4, search_count, unique_dates }]
  }
}
Ingresos Response:
{
  success: boolean,
  data: {
    revenue_summary: { total_revenue, total_reservations, avg_revenue_per_reservation... }
    revenue_by_period: [{ period, revenue, nights, reservations }]
    payment_distribution: [{ payment_method, amount, percentage }]
    price_analysis: { min_price, max_price, avg_price, price_ranges }
    growth_metrics: { revenue_growth, reservations_growth, comparison_period }
  }
}
Upcoming Checkins Response:
{
  success: boolean,
  data: {
    summary_metrics: { total_upcoming_dates, avg_searches_per_date, most_popular_checkin }
    top_upcoming_checkins: [{ checkin_date, searches_count, popularity_score }]
  }
}
ğŸ”„ Flujo de Datos
Filtros Globales â†’ Se cambian en StatsPage
Filtros â†’ Se pasan como props a cada dashboard
Dashboards â†’ Usan useGetXXXQuery() hooks de RTK Query
Servicios â†’ Construyen URLs con parÃ¡metros y hacen requests
Respuestas â†’ Se procesan con utilidades de formateo seguro
UI â†’ Renderiza charts, tablas y mÃ©tricas
ğŸ›¡ï¸ Formateo Seguro
ImplementÃ© utilidades que previenen crashes:

// /utils/formatters.ts
formatNumber(value)     â†’ "1,234" (safe locale formatting)
formatCurrency(value)   â†’ "PEN 1,234" (safe currency) 
formatPercent(value)    â†’ "12.5%" (safe percentage)
safeArray(value)        â†’ [] (fallback for arrays)
safeString(value)       â†’ "N/A" (fallback for strings)
ğŸ“± Sistema de Filtros Globales
Los filtros se comparten entre todos los dashboards:

Rangos de fechas: Presets (7d, 30d, 90d) + personalizado
Tipos de usuarios: Incluir/excluir clientes y anÃ³nimos
Moneda: PEN/USD (solo para ingresos)
PerÃ­odo: day/week/month (solo para ingresos)
LÃ­mites: days_ahead y limit (solo para checkins)
Esta estructura es modular, tipo-segura y resistente a errores de API. Cada dashboard es independiente pero comparte filtros comunes.